# 前端搜索模式修复报告

## 🔍 问题描述

用户反映前端选择的是"传统搜索"模式，但实际调用的还是智能搜索接口 `/api/v1/generate_awesome_list_intelligent`。

## 🕵️ 问题根因分析

通过代码分析发现两个关键问题：

### 1. Store中硬编码智能搜索接口
在 `awesome-agent-frontend/src/stores/awesomeList.ts` 中：
```typescript
// 问题：硬编码调用智能搜索接口
const response = await axios.post(
  `${appStore.config.apiBaseUrl}/api/v1/generate_awesome_list_intelligent`, // 硬编码
  { ... }
)
```

### 2. 前端未传递搜索模式参数
在 `HomeView.vue` 中：
```typescript
// 问题：没有传递 searchMode 参数
const requestData = {
  topic: searchQuery.value.trim(),
  model: selectedModel.value,
  language: selectedLanguage.value,
  maxResults: maxResults.value
  // 缺少: searchMode: searchMode.value
}
```

## ✅ 修复方案

### 1. 修改Store支持动态接口选择

**文件**: `awesome-agent-frontend/src/stores/awesomeList.ts`

```typescript
export interface GenerateRequest {
  topic: string
  model: string
  maxResults: number
  language: string
  searchMode?: string  // ✅ 添加搜索模式参数
}

// ✅ 根据搜索模式动态选择API接口
const apiEndpoint = request.searchMode === 'traditional' 
  ? '/api/v1/generate_awesome_list'  // 传统搜索
  : '/api/v1/generate_awesome_list_intelligent'  // 智能搜索

console.log(`使用 ${request.searchMode === 'traditional' ? '传统搜索' : '智能搜索'} 模式，调用接口: ${apiEndpoint}`)

const response = await axios.post(
  `${appStore.config.apiBaseUrl}${apiEndpoint}`,  // ✅ 动态接口
  { ... }
)
```

### 2. 修改HomeView传递搜索模式

**文件**: `awesome-agent-frontend/src/views/HomeView.vue`

```typescript
// ✅ 传递搜索模式参数
const requestData = {
  topic: searchQuery.value.trim(),
  model: selectedModel.value,
  language: selectedLanguage.value,
  maxResults: maxResults.value,
  searchMode: searchMode.value  // ✅ 添加搜索模式
}

console.log('发送请求:', requestData)  // ✅ 添加调试日志
```

### 3. 优化进度显示

根据不同搜索模式显示不同的进度步骤：

**传统搜索模式（3步）**：
1. 直接搜索 - 搜索用户输入的关键词
2. 结果排序 - 智能筛选和排序搜索结果
3. 内容整理 - 生成结构化的 Awesome List

**智能搜索模式（4步）**：
1. 主题扩展 - AI分析搜索主题，生成相关关键词
2. 智能搜索 - 在 arXiv、GitHub 等平台搜索相关资源
3. 内容筛选 - 智能筛选和排序搜索结果
4. 列表生成 - 生成结构化的 Awesome List

### 4. 添加搜索模式监听

```typescript
// ✅ 监听搜索模式变化，自动更新进度步骤
watch(
  () => searchMode.value,
  () => {
    updateProgressSteps()
  }
)
```

## 🎯 修复效果

### 现在的行为：
1. **传统搜索模式**: 调用 `/api/v1/generate_awesome_list` 接口
2. **智能搜索模式**: 调用 `/api/v1/generate_awesome_list_intelligent` 接口
3. **控制台日志**: 清楚显示使用的搜索模式和调用的接口
4. **进度显示**: 根据搜索模式显示不同的步骤
5. **实时切换**: 用户切换搜索模式时，进度步骤自动更新

### 测试验证：
现在前端日志会显示：
```
发送请求: { topic: "Web 开发", model: "gpt", language: "zh", maxResults: 20, searchMode: "traditional" }
使用传统搜索模式，调用接口: /api/v1/generate_awesome_list
```

或者：
```
发送请求: { topic: "Web 开发", model: "gpt", language: "zh", maxResults: 20, searchMode: "intelligent" }
使用智能搜索模式，调用接口: /api/v1/generate_awesome_list_intelligent
```

## 🛠️ 部署建议

1. 重新构建前端应用
2. 测试两种搜索模式是否正确调用对应的API接口
3. 检查控制台日志确认接口调用正确

现在前端搜索模式选择应该能正确工作了！🎉 